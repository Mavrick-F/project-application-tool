<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Memphis MPO - Project Application Tool v1.1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS for map rendering -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

  <!-- Leaflet Draw CSS for drawing tools -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"
    integrity="sha384-NZLkVuBRMEeB4VeZz27WwTRvlhec30biQ8Xx7zG7JJnkvEKRg5qi6BNbEXo9ydwv" crossorigin="anonymous"/>

  <!-- Application Styles -->
  <link rel="stylesheet" href="src/styles.css">
</head>
<body>
  <!-- Mobile/small screen warning -->
  <div id="mobileWarning">
    <div>
      <h2>Desktop Browser Required</h2>
      <p>This tool requires a desktop browser with a minimum width of 1024px.</p>
    </div>
  </div>

  <!-- Main application -->
  <div id="app">
    <!-- Header -->
    <header>
      <img src="./assets/MPO-RTP_Logo_Fullcolor_Landscape_FINAL.png" alt="RTP 2055 Logo">
      <h1><span class="header-year">2055 RTP</span> <span class="header-app">Application Mapping Tool</span></h1>
    </header>

    <!-- Main container -->
    <div id="container">
      <!-- Sidebar -->
      <aside id="sidebar">
        <div class="sidebar-section">
          <div class="section-heading">Draw Your Project</div>
          <button class="btn btn-draw" id="drawLineButton">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
              <line x1="5" y1="19" x2="19" y2="5"></line>
              <circle cx="5" cy="19" r="2"></circle>
              <circle cx="19" cy="5" r="2"></circle>
            </svg>
            Draw Alignment (Line)
          </button>
          <button class="btn btn-draw" id="drawPointButton">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            Mark Location (Point)
          </button>
          <div class="helper-text">Choose line for corridor projects or point for specific locations</div>
          <button class="btn btn-secondary" id="zoomExtentButton" style="margin-top: 10px; display: flex; align-items: center; justify-content: center;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
              <rect x="3" y="3" width="18" height="18" rx="2"></rect>
              <path d="M9 3v18M15 3v18M3 9h18M3 15h18"></path>
            </svg>
            Zoom to Full Extent
          </button>
        </div>

        <div class="divider"></div>

        <!-- Project name and PDF section - hidden until drawing complete -->
        <div id="projectNameSection">
          <div class="sidebar-section">
            <div class="section-heading">Generate Report</div>
            <label for="projectName" style="font-size: 13px; color: #666; margin-bottom: 5px; display: block;">Project Name</label>
            <input
              type="text"
              id="projectName"
              placeholder="Enter project name..."
              aria-label="Project Name"
            >
            <div class="helper-text" style="margin-bottom: 15px;">Required for PDF report</div>

            <button class="btn btn-primary" id="pdfButton" disabled>
              Download PDF Report
            </button>

            <button class="btn btn-secondary" id="clearButton">
              Clear & Start Over
            </button>
          </div>

          <div class="divider"></div>
        </div>

        <div class="sidebar-section">
          <div class="section-heading">Analysis Results</div>

          <!-- Dynamic results container - populated by JavaScript -->
          <div id="resultsContainer">
            <div style="padding: 20px; text-align: center; color: #666;">
              <p style="font-size: 16px; margin: 0;">Draw a project to see analysis results</p>
              <p style="font-size: 13px; margin-top: 10px; color: #999;">Click "Draw Alignment" or "Mark Location" above to get started</p>
            </div>
          </div>
        </div>
      </aside>

      <!-- Map -->
      <div id="map"></div>
    </div>
  </div>

  <!-- Loading overlay -->
  <div id="loadingOverlay">
    <div class="spinner"></div>
    <div id="loadingText">Loading map data...</div>
  </div>

  <!-- Tutorial popup -->
  <div id="tutorialOverlay"></div>
  <div id="tutorialPopup">
    <h2>Welcome to the Project Application Tool</h2>
    <ul>
      <li>Draw a line for corridor projects or mark a point for intersection projects</li>
      <li>The tool automatically analyzes your project against regional planning datasets</li>
      <li>Review results in real-time, then download a PDF report to attach to your application</li>
      <li>The box in the upper left can toggle layers on and off for manual inspection, but this is not required for the analysis and pdf creation</li>
    </ul>
    <button class="tutorial-close" id="tutorialCloseButton">Got it!</button>
  </div>

  <!-- CDN Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"
    integrity="sha384-JP5UPxIO2Tm2o79Fb0tGYMa44jkWar53aBoCbd8ah0+LcCDoohTIYr+zIXyfGIJN" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"
    integrity="sha384-82q0nm29xZzIo5BMtDYnh2/NxeO6FoaK1S/0nF84w3cEsqbBfun3JdMyDVYWfVY5" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/martinez-polygon-clipping@0.7.2/dist/martinez.min.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"
    integrity="sha384-JcnsjUPPylna1s1fvi1u12X5qjY5OL56iySh75FdtrwhO/SWXgMjoVqcKyIIWOLk" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"
    integrity="sha384-ZZ1pncU3bQe8y31yfZdMFdSpttDoPmOZg2wguVK9almUodir1PghgT0eY7Mrty8H" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/js-yaml@4.1.0/dist/js-yaml.min.js"
    integrity="sha384-+pxiN6T7yvpryuJmE1gM9PX7yQit15auDb+ZwwvJOd/4be2Cie5/IuVXgQb/S9du" crossorigin="anonymous"></script>

  <!-- Application Scripts (load in order) -->
  <!-- Version string for cache busting - update when releasing new version (see README.md for current version) -->
  <script src="src/datasets.js?v=1.1"></script>
  <script src="src/map.js?v=1.1"></script>
  <script src="src/analysis.js?v=1.1"></script>
  <script src="src/pdf.js?v=1.1"></script>
  <script src="src/app.js?v=1.1"></script>
</body>
</html>
